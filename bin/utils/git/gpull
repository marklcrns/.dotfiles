#!/bin/bash

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

pullrepo() {
  # Check if in git repo
  [[ ! -d ".git" ]] && echo "$(pwd) not a git repo. root" && return 1
  # Check for git repo changes
  changes=$(git status --porcelain --untracked-files=no)
  # Pull if no changes
  if [[ -n ${changes} ]]; then
    if [[ -n ${FORCE_PULL} ]]; then
      printf "${YELLOW}Changes detected in $(pwd) files. Hard resetting repo...${NC}\n"
      git reset --hard HEAD^
      git pull --all
    else
      printf "${RED}Changes detected in $(pwd) files. Skipping...${NC}\n"
    fi
  else
    echo "$(pwd). Pulling from remote"
    git pull --all
    # If Authentication failed, push until successful or interrupted
    while [[ ${?} -eq 128 ]]; do
      git push --all
    done
  fi
}

